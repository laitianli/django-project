
<!-- NAT -->
<interface type="network">
    <mac address="52:54:00:c7:dc:18" />
    <source network="default" />
    <model type="virtio" />
    <address type="pci" domain="0x0000" bus="0x01" slot="0x00" function="0x0" />
</interface>


<!-- bridge -->
<interface type="bridge">
    <mac address="52:54:00:c7:dc:19" />
    <source bridge="br0" />  <!-- 关键修改：将 network 改为 bridge -->
    <model type="virtio" />
    <address type="pci" domain="0x0000" bus="0x01" slot="0x00" function="0x0" />
</interface>

<!-- ovs bridge -->
<interface type='bridge'> 
  <mac address='52:54:00:4a:c3:3b'/>
  <source bridge='ovs0'/> 
  <virtualport type='openvswitch'/> <!-- 明确指定使用OVS -->
  <model type='virtio'/> 
</interface>

<!-- 
apt install openvswitch-switch -y
systemctl status openvswitch-switch
systemctl enable openvswitch-switch

ovs-vsctl add-br ovs0
ovs-vsctl list-br
ovs-vsctl br-exists ovs0
ovs-vsctl show

# 移除物理网卡的原有IP配置
ip addr flush dev enp0s3

# 将网卡添加到网桥
ovs-vsctl add-port ovs0 enp0s3

# 查看网桥上的端口
ovs-vsctl list-ports ovs0

ovs-vsctl del-br ovs0 

apt install openvswitch-switch-dpdk -y

Created symlink /etc/systemd/system/multi-user.target.wants/dpdk.service → /lib/systemd/system/dpdk.service.
/lib/systemd/system/dpdk.service
/lib/dpdk/dpdk-init
/etc/dpdk/interfaces

export OVS_BR=dpdkovs-br0
ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-lcore-mask=0xE
ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-socket-mem=1024
ovs-vsctl add-br ${OVS_BR} -- set bridge ${OVS_BR} datapath_type=netdev
export OVS_PHYIF=dpdk-phy0
export NIC_PCIEID=0000:1b:00.3
ovs-vsctl add-port ${OVS_BR} ${OVS_PHYIF} -- set Interface ${OVS_PHYIF} type=dpdk options:dpdk-devargs=${NIC_PCIEID}
ip link set ${OVS_BR} up

##验证dpdk是否已经初始化
ovs-vsctl get Open_vSwitch . dpdk_initialized
-->
<!-- ovs-dpdk -->
<memoryBacking>
  <hugepages/>
  <access mode='shared'/>
</memoryBacking>

<interface type='vhostuser'>
    <mac address='52:54:00:63:5b:59'/>
    <source type='unix' path='/tmp/qemu-vm_9_vhost-user.sock' mode='server'/>
    <model type='virtio'/>
    <driver queues='4'/>
    <address type='pci' domain='0x0000' bus='0x00' slot='0x08' function='0x0'/>
</interface>


cd /home/haizhi/downland/qemu-ovs-dpdk-lab/bin/ovs/tools && run_ovs_dpdk.sh start

/home/haizhi/downland/qemu-ovs-dpdk-lab/bin/ovs/bin/ovs-vsctl \
	--db=unix:/usr/local/var/run/openvswitch/db.sock add-port \
	ovs-br0 dpdkvhostclient0  -- set Interface dpdkvhostclient0 \
	type=dpdkvhostuserclient options:vhost-server-path=/tmp/qemu-vm_9_vhost-user.sock



<!-- Macvtap -->
<interface type="direct">
    <mac address="52:54:00:c7:dc:18" />
    <source dev="enp184s0f1" mode="bridge"/>
    <model type="virtio" />
</interface>
/* macvtap */
ip link add link eth0 name macvtap0 type macvtap

<!-- NAT
BRIDGE
OPEN
CLOSE
SR_IOV -->

<!--
WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE
OVERWRITTEN AND LOST. Changes to this xml configuration should be made using:
  virsh net-edit default
or other application using the libvirt API.
-->

<network>
  <name>default</name>
  <uuid>b604aa17-1459-4369-ae06-9cbf8d142111</uuid>
  <forward mode='nat'/>
  <bridge name='virbr0' stp='on' delay='0'/>
  <mac address='52:54:00:83:1e:50'/>
  <ip address='192.168.122.1' netmask='255.255.255.0'>
    <dhcp>
      <range start='192.168.122.2' end='192.168.122.254'/>
    </dhcp>
  </ip>
</network>

<!-- NAT-phyNIC: ens3 -->
<network>
  <name>network-NAT</name>
  <uuid>b604aa17-1459-4369-ae06-9cbf8d142111</uuid>
  <forward dev="ens3" mode='nat'>
    <nat>
        <port start="1024" end="65535"/>
    </nat>
  </forward>
  <bridge name='virbr1' stp='on' delay='0'/>
  <mac address='52:54:00:83:1e:50'/>
  <domain name="network-NAT"/>
  <ip address='192.168.122.1' netmask='255.255.255.0'>
    <dhcp>
      <range start='192.168.122.2' end='192.168.122.254'/>
    </dhcp>
  </ip>
</network>

<!-- Route-phyNIC: ens3 -->
<network>
  <name>network-Route</name>
  <uuid>b604aa17-1459-4369-ae06-9cbf8d142111</uuid>
  <forward dev="ens3" mode='route'>
    <interface dev="ens3"/>
  </forward>
  <bridge name='virbr1' stp='on' delay='0'/>
  <mac address='52:54:00:83:1e:50'/>
  <domain name="network-Route"/>
  <ip address='192.168.100.1' netmask='255.255.255.0'>
    <dhcp>
      <range start='192.168.100.2' end='192.168.100.254'/>
    </dhcp>
  </ip>
</network>

<!-- OPEN -->
<network>
  <name>network-OPEN</name>
  <uuid>b604aa17-1459-4369-ae06-9cbf8d142111</uuid>
  <forward mode='open'/>
  <bridge name='virbr1' stp='on' delay='0'/>
  <mac address='52:54:00:83:1e:50'/>
  <domain name="network-OPEN"/>
  <ip address='192.168.100.1' netmask='255.255.255.0'>
    <dhcp>
      <range start='192.168.100.2' end='192.168.100.254'/>
    </dhcp>
  </ip>
</network>

<!-- isolated -->
<network>
  <name>network-isolated</name>
  <uuid>b604aa17-1459-4369-ae06-9cbf8d142111</uuid>
  <bridge name='virbr1' stp='on' delay='0'/>
  <mac address='52:54:00:83:1e:50'/>
  <domain name="network-OPEN"/>
  <ip address='192.168.100.1' netmask='255.255.255.0'>
    <dhcp>
      <range start='192.168.100.2' end='192.168.100.254'/>
    </dhcp>
  </ip>
</network>

<!-- SR-IOV -->

<!-- bridge -->
<network>
  <name>example_bridge</name>
  <uuid>d6e01520-9c10-4cd1-8163-a488293790a3</uuid>
  <forward mode='bridge'/>
  <bridge name='br0'/>
</network>

 net-define /home/haizhi/bridge.xml 
 net-start example_bridge
 net-autostart example_bridge

ip link set dev enp27s0f0np0 down
ip addr flush dev enp27s0f0np0
ip link set dev enp27s0f0np0 master br0
ip link set dev enp27s0f0np0 up
ip link set dev br0 up

ip link show master br0 

/* ovs */
<network>
  <name>br2</name>
  <uuid>a0da8c0c-1e26-430b-ade9-fc581d598241</uuid>
  <forward mode='bridge'/>
  <bridge name='br2'/>
  <virtualport type='openvswitch'/>
</network>



<video>
  <model type='qxl' vram='9126' heads='1'/>
</video>

<!-- 4K分辨率 -->
<video>
  <model type='qxl' ram='65536' vram='9126' vgamem='16384' heads='1'/>
</video>

<!-- 8K分辨率 -->
<video>
  <model type='qxl' ram='262144' vram='16384' vgamem='131072' heads='1'/>
</video>


<video>
  <model type='qxl' ram='65536' vram='16384' vgamem='16384' heads='1' primary='yes'/>
</video>

mkdir -p /var/log/openvswitch
DEFAULT_DBSOCK=/home/haizhi/downland/qemu-ovs-dpdk-lab/source/ovs/../../bin/ovs/var/run/openvswitch/db.sock
ovsdb-server \
	/etc/openvswitch/conf.db \
	--remote=punix:${DEFAULT_DBSOCK} \
	--private-key=db:Open_vSwitch,SSL,private_key \
	--certificate=db:Open_vSwitch,SSL,certificate \
	--bootstrap-ca-cert=db:Open_vSwitch,SSL,ca_cert \
	--no-chdir \
	--log-file=/var/log/openvswitch/ovsdb-server.log \
	--pidfile=/var/run/openvswitch/ovsdb-server.pid \
	--detach
ovs-vswitchd \
	unix:${DEFAULT_DBSOCK} \
	--no-chdir \
	--log-file=/var/log/openvswitch/ovs-vswitchd.log \
	--pidfile=/var/run/openvswitch/ovs-vswitchd.pid \
	--detach